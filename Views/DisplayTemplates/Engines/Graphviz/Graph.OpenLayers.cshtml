@{
    Script.Require("MapQuery.ImageLayer").AtHead();

    var routeData = Html.ViewContext.RouteData.Values;
}
<script type="text/javascript">
$(document).ready(function(){
	$.getJSON("@Url.Action("Render", routeData["controller"].ToString())?" + $("#associativy-search-form").serialize(), function(response) {
        /// Native OpenLayers implementation
        var map = new OpenLayers.Map("map");
        var urls = response["GraphImageUrls"];
        var maxZoomLevelsPerLayer = 3;
        var layerCount = urls.length;
        var layerSwitched = 0;

        for (var i = 0; i < urls.length; i++) {
            var layer = new OpenLayers.Layer.Image(
                            "layer-" + i,
                            urls[i],
                            new OpenLayers.Bounds(-180, -88.759, 180, 88.759),
                            new OpenLayers.Size(600, 400),
                            {numZoomLevels: maxZoomLevelsPerLayer + 1}
                        );
            layer.events.on({
                                moveend: function(e) {
                                    if (e.zoomChanged) {
                                        // This whole juggling with layerSwitched is because setBaseLayer() calls this event handler,
                                        // with zoomChanged == true, twice!
                                        if (layerSwitched != 0) {
                                            layerSwitched--;
                                            return;
                                        }

                                        var layer = e.object;
                                        var map = layer.map;
                                        var zoom = map.zoom;
                                        var layerIndex = map.getLayerIndex(layer);

                                        if(zoom == 0 && layerIndex != 0) {
                                            layerSwitched = 2;
                                            map.zoom = maxZoomLevelsPerLayer;
                                            map.setBaseLayer(map.layers[layerIndex - 1]);
                                        }
                                        else if (zoom == maxZoomLevelsPerLayer && layerIndex + 1 < layerCount) {
                                            layerSwitched = 2;
                                            map.zoom = 0;
                                            map.setBaseLayer(map.layers[layerIndex + 1]);
                                        }
                                    }
                                }
                        }); 
            map.addLayer(layer);
        }

        map.addControl(new OpenLayers.Control.LayerSwitcher());
        map.zoomToMaxExtent();


//        /// MapQuery implementation
//        var urls = response["GraphImageUrls"];
//        var layers = [];
//        
//        for (var i = 0; i < urls.length; i++) {
//            layers[i] = {
//                type:"image",
//                name: "layer-" + i,
//                url: urls[i],
//                extent: new OpenLayers.Bounds(-180, -88.759, 180, 88.759),
//                size: new OpenLayers.Size(580, 288),
//                options: {numZoomLevels: 3}};
//        }

//        var mapQuery = $("#map").mapQuery({
//                maxExtent:[-180,-90,180,90],
//                projection:'EPSG:4326',
//                units:'degrees',
//                layers: layers
//            }).data("mapQuery");

////        for (var i = 0; i < urls.length; i++) {
////            mapQuery.olMap.addLayer(
////                new OpenLayers.Layer.Image(
////                    "layer-" + i,
////                    urls[i],
////                    new OpenLayers.Bounds(-180, -88.759, 180, 88.759),
////                    new OpenLayers.Size(580, 288),
////                    {numZoomLevels: 3}
////                ));
////        }


//        mapQuery.olMap.addControl(new OpenLayers.Control.LayerSwitcher());
//        mapQuery.center({position:[5,52],zoom:2});
    });
});
</script>
<div id="map" class="smallmap" style="width: 600px; height: 400px;">
</div>