@model Associativy.Frontends.Models.IGraphAspect
@using Orchard.ContentManagement

@{
    Script.Require("AssociativyFrontends_Jit").AtHead();
    Style.Require("AssociativyFrontends_Jit");

    var initialZoomLevel = Model.As<Associativy.Frontends.Models.IEngineConfigurationAspect>().MindSettings.ZoomLevel;
    var maxZoomLevel = Model.ZoomLevelCount - 1;
}
<script type="text/javascript">
(function ($) {
    $.extend(true, {
        associativy: {
            layout: null,
            jit: {
                loadGraph: function (zoomLevel, redraw, isPartialGraph) {
                    var that = this;
                    $.post(
                        "@Url.Action("FetchGraph", ViewContext.RouteData.Values)?ZoomLevel=" + zoomLevel + "&" + $("#associativy-search-form").serialize(), 
                        { __RequestVerificationToken: "@Html.AntiForgeryTokenValueOrchard()" },
                        function(graphData) {
                            if (!redraw) that.layout = $.associativy.jit.draw("associativy-jit-associations-canvas", graphData);
                            else $.associativy.jit.redraw(that.layout, graphData);
                    });
                }
            }
        }
    });

    $(document).on("stop.AssociativyGraphZoomSlider", function(values) {
        $.associativy.jit.loadGraph(values.ui.value, true);
    });

    $(document).ready(function() {
        $.associativy.jit.loadGraph(@initialZoomLevel, false);
    });
})(jQuery);
</script>

@Display.GraphZoomSlider(CurrentZoomLevel: initialZoomLevel, MaxZoomLevel: maxZoomLevel)
<div id="associativy-jit-associations-canvas">
</div>
@Display.AssociativyBadgeOfHonor()
